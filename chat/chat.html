<!doctype html>
<html>

<head>
    <title>Crono chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Chat">
    <!-- ############################################################################ -->
    <!--                       Imports e barra de navegação                           -->
    <!-- ############################################################################ -->
    <link rel="icon" href="/public/img/favicon.ico">
    <!-- Include Jquery Js -->
    <script src="/public/js/jquery-2.1.4.min.js"></script>
    <script src="/public/js/jquery-ui-1.10.2.custom.min.js"></script>
    <link rel="stylesheet" href="/public/css/jquery-ui-1.10.2.custom.min.css">
    <!-- Include Bootstrap Css -->
    <link rel="stylesheet" href="/public/css/bootstrap.min.css">
    <!-- Include Bootstrap Min Css -->
    <link rel="stylesheet" href="/public/css/bootstrap-theme.min.css">
    <!-- Include Bootstrap Js -->
    <script src="/public/js/bootstrap.min.js"></script>
    <!-- Include Responsive Css -->
    <link rel="stylesheet" href="/public/css/responsive.min.css">
    <!-- Include Fontawesome Min Css -->
    <link rel="stylesheet" href="/public/css/font-awesome.min.css">
    <!-- Include Extra Css -->
    <link rel="stylesheet" href="/public/css/style2.css">
    <!-- Include Style Css -->
    <link rel="stylesheet" href="/public/css/style.css">
    <!-- Include Responsive Css -->
    <link rel="stylesheet" href="/public/css/responsive.min.css">
    <!-- Include Modernizer Js -->
    <script src="/public/js/modernizr-2.8.3-respond-1.4.2.min.js"></script>
    <!-- Include Shiny Icon Css -->
    <link rel="stylesheet" href="/public/css/shiny-icon.css">


    <!-- Include Initialization script Js -->
    <script src="/components/components.js"></script>
    <script src="/script/global.js"></script>
    <script src="/script/theme.js"></script>

    <!-- ############################################################################ -->
    <!--                              Imports particulares                            -->
    <!-- ############################################################################ -->
    <!-- Personal Css and Js -->
    <link href='/light-default.css' rel='stylesheet' type='text/css'>
    <link href='/chat.css' rel='stylesheet' type='text/css'>

    <script src="/public/js/socket.io-1.4.5.js"></script>
    <div id="navbar"></div>
</head>

<body>
    <br>
    <br>
    <br>
    <br>
    <div class="title">
        <div class="title-text">
            <h1>Chat</h1>
        </div>
        <div class="title-side">
            <h3>Contact:
                <a class="btn btn-danger" href="https://github.com/ftuyama/Crono">
                    <i class="fa fa-bug"></i>Crono
                </a>
            </h3>
        </div>
    </div>
    <hr>
    <div class="row row-message">
        <div class="col-sm-2">
            <h3>Online:</h3>
            <hr>
        </div>
        <div class="col-sm-10 row-message">
            <ul id="messages"></ul>
        </div>
    </div>
    <form class="footer" action="">
        <input id="text" class="w3-input" autocomplete="off" />
        <button id="send" class="btn btn-success">Send</button>
    </form>
    <script>
        var username;
        var socket = io.connect('/', {
            path: '/chatS'
        });
        $('form').submit(function() {
            socket.emit('chat message', $('#text').val());
            $('#text').val('');
            return false;
        });
        socket.on('chat', function(msg) {
            var time = msg.key.split(':').slice(5, 8).join(':');
            $('#messages').append(
                $('<p>').html(
                    time + "  " +
                    '<b style="color:#c66">@' + msg.value.user + '</b> ' +
                    '<span style="color:#6c6">said</span> ' +
                    msg.value.message
                )
            );
            scrollBotton();
        });
        socket.on('connected', function(msg) {
            var time = msg.key.split(':').slice(5, 8).join(':');
            username = msg.value.user;
            $('#messages').append(
                $('<p>').html(
                    time + "  " +
                    '<b style="color:#c66">@' + msg.value.user +
                    '<span style="color:#6c6"> connected</span> '
                )
            );
            scrollBotton();
        });
        socket.on('disconnected', function(msg) {
            var time = msg.key.split(':').slice(5, 8).join(':');
            $('#messages').append(
                $('<p>').html(
                    time + "  " +
                    '<b style="color:#c66">@' + msg.value.user +
                    '<span style="color:#6c6"> disconnected</span> '
                )
            );
            scrollBotton();
        });
        socket.on('history', function(history) {
            [dest, msg] = [history.dest, history.msg];
            if (dest != username) return;
            alert(dest);
            var kind = msg.key.split(':').slice(1, 2)[0];
            var time = msg.key.split(':').slice(5, 8).join(':');
            var value = JSON.parse(msg.value);
            $('#messages').append(
                $('<p>').html(
                    time + "  " +
                    '<b style="color:#c66">@' + value.user + '</b> ' +
                    '<span style="color:#6c6">' + kind + '</span> ' +
                    value.message
                )
            );
            scrollBotton();
        });

        function scrollBotton() {
            var scroll = document.getElementById('messages');
            scroll.scrollTop = scroll.scrollHeight
        }
    </script>
</body>

</html>